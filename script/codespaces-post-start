#!/usr/bin/env bash

SCRIPT_NAME=${1:-"script/codepaces-post-start"}

# Send all our -x output to this file for later debugging
LOG_DIR="$HOME/codepaces-post-start.logs"
mkdir -p "${LOG_DIR}"
exec 1>"${LOG_DIR}/stdout"
exec 2>"${LOG_DIR}/stderr"
exec 19>"${LOG_DIR}/trace"
BASH_XTRACEFD=19

set -x

echo "${SCRIPT_NAME} start: $(date)"

# DOTFILES_ROOT=$(pwd -P)

set -e

echo ""

if [ -d "$HOME/zsh-git-prompt" ]
then
  echo "Updating zsh-git-prompt..."
  (cd "$HOME/zsh-git-prompt" && git pull)
else
  echo "Cloning zsh-git-prompt..."
  git clone https://github.com/olivierverdier/zsh-git-prompt.git "$HOME/zsh-git-prompt"
fi

# Always want to use ZSH as my default shell (e.g. for SSH)
if ! grep -q "root.*/bin/zsh" /etc/passwd
then
  sudo chsh -s /bin/zsh root
fi

git config --global --unset url."git@github.com:".insteadOf

apt-get install -y \
  zsh-autosuggestions \
  zsh-syntax-highlighting

echo ""
echo "üèÅ Post start script finished! üèÅ"
